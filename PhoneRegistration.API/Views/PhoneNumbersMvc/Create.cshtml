@*@model PhoneRegistration.Application.Services.PhoneNumber.RegisterPhoneNumberDto

<form asp-action="Create" method="post">
    <label>Mobile Number</label>
    <input asp-for="Mobile" />
    <span asp-validation-for="Mobile"></span>
    <button type="submit">Submit</button>
</form>

@if (TempData["SuccessMessage"] != null)
{
    <div>@TempData["SuccessMessage"]</div>
}*@
@model PhoneRegistration.Application.Services.PhoneNumber.RegisterPhoneNumberDto

@{
    ViewData["Title"] = "Register Phone Number";
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewData["Title"]</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="card shadow-lg p-4"
             style="max-width: 430px; width: 100%; border-radius: 20px;">

            <h4 class="text-center mb-4 text-primary">📱 ثبت شماره موبایل</h4>

            <form id="phoneForm">
                <div class="mb-3">
                    <label class="form-label">شماره موبایل</label>
                    <input id="Mobile" asp-for="Mobile"
                           class="form-control"
                           placeholder="مثال: 09123456789" />
                </div>

                <button type="submit" class="btn btn-primary w-100">
                    ثبت شماره
                </button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
        <div id="toast"
             class="toast align-items-center text-white border-0"
             role="alert"
             aria-live="assertive"
             aria-atomic="true">

            <div class="d-flex">
                <div id="toast-body" class="toast-body"></div>
                <button type="button"
                        class="btn-close btn-close-white me-2 m-auto"
                        data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const toastElement = document.getElementById("toast");
        const toastBody = document.getElementById("toast-body");
        const toast = new bootstrap.Toast(toastElement);

        function showToast(message, isSuccess = true) {
            toastElement.classList.remove("bg-success", "bg-danger");
            toastElement.classList.add(isSuccess ? "bg-success" : "bg-danger");
            toastBody.innerText = message;
            toast.show();
        }

        document.getElementById("phoneForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const mobile = document.getElementById("Mobile").value;
            console.log(mobile);

            try {
                const response = await fetch("/PhoneNumbersMvc/Create", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ mobile:mobile })
                });

                const result = await response.json();

                if (result.isSuccess) {
                    showToast(result.message, true);
                    document.getElementById("Mobile").value = "";
                } else {
                    showToast(result.message, false);
                }
            }
            catch {
                showToast("❌ خطای ارتباط با سرور", false);
            }
        });
    </script>

</body>
</html>
